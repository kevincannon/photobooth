<html>

<head>

<style type="text/css">
	
	canvas {
		border: 1px solid red;
	}

</style>
<script src="https://code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>


</head>

<body>

	<h1>IsarWG3 Photobooth</h1>

	<button id="take-photo">Take Photo</button> <br>

	<video id="webcam" autoplay="true" ></video>
	
	<canvas id="webcam-snapshot"></canvas>

	




<script type="text/javascript">

			var CAPTURE_WIDTH = 100;
			var CAPTURE_HEIGHT = CAPTURE_WIDTH * (3/4);
			 
			function handleVideo(stream) {
			    webcam.src = window.URL.createObjectURL(stream);
			}
			 
			function videoError(e) {
			    // do something
			    console.log("camera error");
			}


            // Take Photo
            takePhotoBtn = document.getElementById('take-photo');
            takePhotoBtn.onclick = function(){

            	takePhoto();

            }

            function takePhoto() {

                console.log("take photo");


				canvas.getContext('2d').drawImage(webcam, 0, 0, CAPTURE_WIDTH, CAPTURE_HEIGHT);

				imageData = canvas.toDataURL("image/png");
				// var justPngData = imageData.substr(imageData, imageData.strpos(imageData, ",")+1);

				imageData = imageData.replace('data:image/png;base64,', '');

				// console.log(imageData);

                // saveImage();

                $.ajax({
				    url: '/saveimage',
				    type: 'POST',
				    data: {imgData: imageData},
				    success: function (data) {
				        console.log(data)
				    	}
					})	
            }


			function init() {
				// takePhoto();


	            // Camera 
	            webcam = document.getElementById('webcam');

	            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
	 
				if (navigator.getUserMedia) {      
				    navigator.getUserMedia({video: true}, handleVideo, videoError);
				}

				// Canvas
                canvas = document.getElementById('webcam-snapshot');
                canvas.height = CAPTURE_HEIGHT;
                canvas.width = CAPTURE_WIDTH;


			}
           
			$(document).ready(function(){
           
           		init();	
			}) 

           


</script>


</body>
</html>